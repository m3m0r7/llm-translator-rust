<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ labels.report_title }}</title>
  <style>
    :root { --bg: #0b1220; --panel: #0f1a14; --panel-2: #0b120f; --accent: #34d399; --accent-2: #86efac; --text: #e5e7eb; --muted: #9ca3af; --border: #1f2a24; }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: "IBM Plex Sans", "Segoe UI", sans-serif; background: radial-gradient(circle at 15% 20%, #1e2b23 0%, #0b1220 45%, #060b08 100%); color: var(--text); }
    header { padding: 40px 24px 20px; width: 80%; max-width: 1200px; margin: 0 auto; }
    h1 { margin: 0 0 6px; font-size: 32px; letter-spacing: 0.02em; }
    .subtitle { color: var(--muted); font-size: 14px; }
    main { width: 80%; max-width: 1200px; margin: 0 auto; padding: 0 24px 48px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; margin-bottom: 24px; }
    .card { background: linear-gradient(160deg, var(--panel) 0%, var(--panel-2) 100%); border: 1px solid var(--border); border-radius: 16px; padding: 16px; box-shadow: 0 12px 24px rgba(0,0,0,0.2); }
    .card h2 { margin: 0 0 10px; font-size: 16px; color: var(--accent); text-transform: uppercase; letter-spacing: 0.08em; }
    .stat { font-size: 28px; font-weight: 600; }
    .stat-label { color: var(--muted); font-size: 12px; }
    section { margin-bottom: 28px; }
    section h3 { margin: 0 0 10px; font-size: 18px; color: var(--accent-2); }
    ul { list-style: none; padding: 0; margin: 0; }
    li { padding: 6px 0; border-bottom: 1px dashed var(--border); }
    .count { color: var(--accent); font-weight: 600; margin-right: 8px; }
    .text-item { white-space: pre-wrap; word-break: break-word; }
    .cluster { margin-bottom: 14px; padding: 12px; border: 1px solid var(--border); border-radius: 12px; background: rgba(15, 23, 42, 0.6); }
    .cluster-title { font-weight: 600; margin-bottom: 6px; }
    .keyword { display: flex; flex-wrap: wrap; gap: 8px; }
    .tag { background: rgba(52, 211, 153, 0.12); border: 1px solid rgba(52, 211, 153, 0.35); padding: 4px 8px; border-radius: 999px; font-size: 12px; }
    .chart { display: flex; align-items: flex-end; gap: 10px; height: 180px; padding: 12px 6px 4px; }
    .bar { flex: 1 1 0; display: flex; flex-direction: column; align-items: center; gap: 6px; min-width: 22px; }
    .bar-fill { width: 100%; border-radius: 8px 8px 4px 4px; background: linear-gradient(180deg, var(--accent) 0%, #16a34a 100%); }
    .bar-value { font-size: 11px; color: var(--muted); }
    .bar-label { font-size: 10px; color: var(--muted); transform: rotate(-35deg); white-space: nowrap; }
    .table-wrap { overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    th, td { border-bottom: 1px solid var(--border); padding: 8px; text-align: left; vertical-align: top; }
    th { color: var(--muted); font-weight: 600; }
    td.text-cell { min-width: 220px; }
    .empty { color: var(--muted); font-size: 13px; padding: 8px 0; }
  </style>
</head>
<body>
  <header>
    <h1>{{ labels.report_title }}</h1>
    <div class="subtitle">{{ labels.generated_at }} {{ report.generated_at }} Â· {{ labels.total }} {{ report.totals.total }}</div>
  </header>
  <main>
    <div class="grid">
      <div class="card"><h2>{{ labels.total }}</h2><div class="stat">{{ report.totals.total }}</div><div class="stat-label">{{ labels.totals }}</div></div>
      <div class="card"><h2>{{ labels.text }}</h2><div class="stat">{{ report.totals.text }}</div><div class="stat-label">{{ labels.text }}</div></div>
      <div class="card"><h2>{{ labels.attachment }}</h2><div class="stat">{{ report.totals.attachment }}</div><div class="stat-label">{{ labels.attachment }}</div></div>
    </div>

    <section class="card">
      <h3>{{ labels.daily_volume }}</h3>
      {% if report.daily_bars | length > 0 %}
      <div class="chart">
        {% for bar in report.daily_bars %}
        <div class="bar">
          <div class="bar-fill" style="height: {{ bar.height }}%;"></div>
          <div class="bar-value">{{ bar.count }}</div>
          <div class="bar-label">{{ bar.date }}</div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="empty">No data</div>
      {% endif %}
    </section>

    <section class="card">
      <h3>{{ labels.translated_histories }}</h3>
      {% if report.translated_histories | length > 0 %}
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>{{ labels.history_date }}</th>
              <th>{{ labels.history_type }}</th>
              <th>{{ labels.history_formality }}</th>
              <th>{{ labels.history_source_lang }}</th>
              <th>{{ labels.history_target_lang }}</th>
              <th>{{ labels.history_source_text }}</th>
              <th>{{ labels.history_target_text }}</th>
              <th>{{ labels.history_tags }}</th>
            </tr>
          </thead>
          <tbody>
            {% for item in report.translated_histories %}
            <tr>
              <td>{{ item.datetime }}</td>
              <td>{{ item.kind }}</td>
              <td>{% if item.formality != "" %}{{ item.formality }}{% else %}-{% endif %}</td>
              <td>{{ item.source_lang }}</td>
              <td>{{ item.target_lang }}</td>
              <td class="text-cell">{{ item.source_text }}</td>
              <td class="text-cell">{{ item.target_text }}</td>
              <td>
                {% if item.tags | length > 0 %}
                <span class="keyword">
                  {% for tag in item.tags %}
                  <span class="tag">{{ tag }}</span>
                  {% endfor %}
                </span>
                {% else %}
                -
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="empty">No data</div>
      {% endif %}
    </section>

    <section class="card">
      <h3>{{ labels.language_pairs }}</h3>
      <ul>
        {% for item in report.languages %}
        <li><span class="count">{{ item.count }}</span>{{ item.label }}</li>
        {% endfor %}
      </ul>
    </section>

    <section class="card">
      <h3>{{ labels.content_types }}</h3>
      <ul>
        {% for item in report.types %}
        <li><span class="count">{{ item.count }}</span>{{ item.label }}</li>
        {% endfor %}
      </ul>
    </section>

    <section class="card">
      <h3>{{ labels.models }}</h3>
      <ul>
        {% for item in report.models %}
        <li><span class="count">{{ item.count }}</span>{{ item.label }}</li>
        {% endfor %}
      </ul>
    </section>

    <section class="card">
      <h3>{{ labels.tags }}</h3>
      {% if report.tags | length > 0 %}
      <ul>
        {% for item in report.tags %}
        <li><span class="count">{{ item.count }}</span>{{ item.label }}</li>
        {% endfor %}
      </ul>
      {% else %}
      <div class="empty">No data</div>
      {% endif %}
    </section>

    <section class="card">
      <h3>{{ labels.clusters }}</h3>
      {% if report.clusters | length > 0 %}
      {% for cluster in report.clusters %}
      <div class="cluster">
        <div class="cluster-title">{{ cluster.label }}</div>
        <ul>
          {% for item in cluster.items %}
          <li><span class="count">{{ item.count }}</span><span class="text-item">{{ item.text }}</span></li>
          {% endfor %}
        </ul>
      </div>
      {% endfor %}
      {% else %}
      <div class="empty">No data</div>
      {% endif %}
    </section>

    <section class="card">
      <h3>{{ labels.keywords }}</h3>
      {% if report.keywords | length > 0 %}
      <ul>
        {% for keyword in report.keywords %}
        <li><span class="count">{{ keyword.count }}</span>{{ keyword.keyword }} <span class="keyword"><span class="tag">{{ keyword.translation }}</span><span class="tag">{{ keyword.pos }}</span></span></li>
        {% endfor %}
      </ul>
      {% else %}
      <div class="empty">No data</div>
      {% endif %}
    </section>
  </main>
</body>
</html>
